//vm.c john morris beck the license to use this code is gpl2 found at gnu.org
//compile: with gcc -std=c99 -O3 -march=native -flto vm.c -o vm
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#define k(x,y) case x:y;break;
#define v g[c]
#define f g[d]
#define w r[c]
#define y r[d]
int main(){
  int c,d,e,j,z[256],*h=z,*s=h,i=256,x=1,g[256];
  //there is a newline and a semicolon between tehse declarations.
  void* r[256];
  while(--i){g[i]=1;r[i]=&r[1];}
  while('\n'!=(*s++=getc(stdin)));h=z;
  while(x){
    c=*(h+1);d=*(h+2);e=*h;j=3;
    switch(e){
      k('-',v=v-f)//sub
	k(1,v=v<f)//lt
	k(2,h=(int*)w;j=0)//funcall
	k(3,w=(void*)((char*)w+(int)v))//add to pointerp
      k(4,w=y)//bp
	k(5,v=f)//bn
	k(6,{w=malloc(f);f=(w==NULL);})//malloc
	      k(7,free(y))//free
	      k(8,e=getc(stdin);v=e)//i
	k('o',putchar(v))//o
	k('.',fflush(stdout))//finish printing
	      k(11,x=0)//shutdown
	      k('k', x=0)
    }
    h+=j;}
  return 0;}
//echo "-n1-n1-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-on-onoo_k__" | ./vm #prints &
